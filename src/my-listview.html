
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">

 



<dom-module id="my-listview">
  <template strip-whitespace>
    <style>
      :host {
        display: block;
      }

      paper-item {
        display: block;
      }

      [icon="add"]{
        display: block;
        position: absolute;
        bottom: 20px;
      }
    </style>
    <!-- structure of listview -->
       <template is="dom-repeat" items="[[taskList]]" index-as="index">
         <paper-dropdown-menu label="status">
            <paper-listbox class="dropdown-content">
              paper-i
            </paper-listbox>
         </paper-dropdown-menu>
         <paper-item>
           <paper-icon-button icon="delete" on-tap="deleteTask"></paper-icon-button>
         </paper-item>
       </template>
       <paper-fab icon="add" on-tap="_showAddTaskDialogBox"></paper-fab>
       <paper-dialog id="taskNameDialogBox">
            <paper-input label="Enter Task Name"></paper-input>
           <div class="buttons">
            <paper-button dialog-dismiss>Cancel</paper-button>
            <paper-button dialog-confirm autofocus>Accept</paper-button>
          </div>
       </paper-dialog>
  </template>
  <script>
    Polymer({
      is: "my-listview",
      properties: {
          taskList: {
            type: Array,
            value: function() {
                    return [
                            
                           ]
                  }
          },

          listName: {
            type: String,
            value: "shopping"
          }
      },
        ready: function() {
          this.taskStatus = false;
          this.task = {
                         
                          
                      };
            this._updateListView();
        },
        updateTaskStatus: function() {
          if (this.taskStatus) {
            this.task.status = "completed";
          } else {
            this.task.status = "uncompleted";
          }
          localStorage.setItem(this.task.name, JSON.stringify(this.task));

        },

        //  when user clicks on add button
        addTask: function() {
              var taskName1 = "go jogging";
               localStorage.setItem(task.name, JSON.stringify({
                              listName: this.listName,
                              name: task.name,
                              status: "uncompleted"
                          }));
              // if taskName is empty show msg otherwis
              // localStorage.setItem(taskName1, JSON.stringify({
              //                 listName: "Exercises",
              //                 name: taskName1,
              //                 status: "uncompleted"
              //             }));
              // var taskName2 = "buy eggs";
              // // if taskName is empty show msg otherwis
              // localStorage.setItem(taskName2, JSON.stringify({
              //                 listName: this.listName,
              //                 name: taskName2,
              //                 status: "uncompleted"
              //             }));  
              //  localStorage.setItem("buy bread", JSON.stringify({
              //                 listName: this.listName,
              //                 name: "buy bread",
              //                 status: "uncompleted"
              //             }));                  
              this._updateListView();

          // localStorage.setItem("go to ppa", JSON.stringify({
          //                 name: "go to ppa",
          //                 status: "uncompleted"
          //             }));
          //   localStorage.setItem("go church", JSON.stringify({
          //                   name: "go church",
          //                   status: "uncompleted"
          //               }));
        },

        
         // on subsequent runs, it should retrive data in database
        _retriveSavedTasks: function() {
            if (localStorage.length !== 0) {
              // retrieve tasks
              var savedTaskList = [];
              for (var key in localStorage) {
                  var savedTask = JSON.parse( localStorage.getItem(key) );
                  if (savedTask.listName === this.listName) {
                        savedTaskList.push({
                        listName: savedTask.listName,
                        name: savedTask.name,
                        status: savedTask.status
                     });
                  }
                  
              }

              return savedTaskList;
           }
        },

        deleteTask: function(event) {
           var taskToDelete = event.model.item;
           localStorage.removeItem(taskToDelete.name);
           var savedTaskList = [];
           this._updateListView();
             

         },

         _showAddTaskDialogBox: function() {
           // use light dom here
            var dialogBox = Polymer.dom(this.root).querySelector('#taskNameDialogBox');
            dialogBox.open();
         },

         // it should clear list

        _updateListView: function() {
               var list = this._retriveSavedTasks();
               if (list.length !== 0) {
                    this.splice('taskList', 0);
                    var self = this;
                    list.forEach(function(savedTask){
                      self.push('taskList',{
                          listName: savedTask.listName,
                          name: savedTask.name,
                          status: savedTask.status
                      });
                  });
               }
               
         }
    });
  </script>
</dom-module>
